<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>		<html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>		<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">

      <title>CommonMark API documentation</title>
      <meta name="description" content="">

  
  <style type="text/css">
  
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    background: #ddd;
    height: 100%;
  }

  #container {
    width: 840px;
    background-color: #fdfdfd;
    color: #111;
    margin: 0 auto;
    border-left: 1px solid #000;
    border-right: 1px solid #000;
    padding: 10px 25px;
    min-height: 100%;
  }

  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    top: 5px;
    left: 5px;
    font-size: 140%;
  }

  h1 {
    margin: 0 0 10px 0;
  }

  h2 {
    margin: 25px 0 10px 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
  }

  a:hover {
    color: #e08524;
  }

  p {
    line-height: 1.35em;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .ident {
    color: #900;
  }

  code {
    background: #e8e8e8;
  } 

  pre {
    background: #e8e8e8;
    padding: 6px;
    margin: 0 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }

  ul#index {
    padding: 0;
    margin: 0;
  }

    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }

    ul#index li {
      margin-bottom: 18px;
    }

      ul#index ul li {
        margin-bottom: 8px;
      }

    ul#index, ul#index ul {
      list-style-type: none;
    }

    ul#index ul {
      margin: 0 0 10px 20px;
      padding: 0;
    }

  .column_list {
    width: 100%;
    display: inline-block;
    margin-left: 20px;
  }

  .column_list:after {
    visibility: hidden;
    display: block;
    font-size: 0;
    height: 0;
    content: " ";
    clear: both;
  }

    .column_list ul {
      float: left;
      text-align: left;
      width: 32%;
      margin: 0 !important;
    }

  .item {
    margin: 0 0 25px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #e8e8e8;
      padding: 4px;
      margin: 0 0 8px 0;
      font-size: 110%;
      font-weight: bold;
    }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 10px 0;
      padding: 0 8px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 10px 8px 0 8px;
      padding: 0;
    }

    .source_link {
      font-weight: bold;
    }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }

  /*****************************/

  </style>

    <style type="text/css">
    .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
    function toggle(id, $link) {
      $node = document.getElementById(id);
      if (!$node)
        return;
      if (!$node.style.display || $node.style.display == 'none') {
        $node.style.display = 'block';
        $link.innerHTML = 'Hide source.';
      } else {
        $node.style.display = 'none';
        $link.innerHTML = 'Show source.';
      }
    }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">

    
  

  


  <h1>Module CommonMark</h1>
  
  
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark', this);">Show source.</a></p>
    <div id="source-CommonMark" class="source">
      <div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># 2014 - Bibek Kafle &amp; Roland Shoemaker</span>
<span class="c"># Port of @jgm&#39;s JavaScript stmd.js implementation of the CommonMark spec</span>

<span class="c"># Basic usage:</span>
<span class="c">#</span>
<span class="c"># import CommonMark</span>
<span class="c"># parser = CommonMark.DocParser()</span>
<span class="c"># renderer = CommonMark.HtmlRenderer()</span>
<span class="c"># print(renderer.render(parser.parse(&#39;Hello *world*&#39;)))</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">json</span>

<span class="c"># if python3 use html.parser and urllib.parse, else use HTMLParser and urllib</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">urllib.parse</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">html.parser</span>
        <span class="n">HTMLunescape</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">()</span><span class="o">.</span><span class="n">unescape</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.entitytrans</span> <span class="kn">import</span> <span class="n">_unescape</span>
        <span class="n">HTMLunescape</span> <span class="o">=</span> <span class="n">_unescape</span>
    <span class="n">HTMLquote</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span>
    <span class="n">HTMLunquote</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span>
    <span class="n">URLparse</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urlparse</span>
    <span class="kn">import</span> <span class="nn">entitytrans</span>
    <span class="n">HTMLunescape</span> <span class="o">=</span> <span class="n">entitytrans</span><span class="o">.</span><span class="n">_unescape</span>
    <span class="n">HTMLquote</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span>
    <span class="n">HTMLunquote</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span>
    <span class="n">URLparse</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span>

<span class="c"># Some of the regexps used in inline parser :&lt;</span>

<span class="n">ESCAPABLE</span> <span class="o">=</span> <span class="s">&#39;[!&quot;#$%&amp;</span><span class="se">\&#39;</span><span class="s">()*+,./:;&lt;=&gt;?@[</span><span class="se">\\\\\\</span><span class="s">]^_`{|}~-]&#39;</span>
<span class="n">ESCAPED_CHAR</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ESCAPABLE</span>
<span class="n">IN_DOUBLE_QUOTES</span> <span class="o">=</span> <span class="s">&#39;&quot;(&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^&quot;</span><span class="se">\\</span><span class="s">x00])*&quot;&#39;</span>
<span class="n">IN_SINGLE_QUOTES</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^</span><span class="se">\&#39;\\</span><span class="s">x00])*</span><span class="se">\&#39;</span><span class="s">&#39;</span>
<span class="n">IN_PARENS</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">((&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^)</span><span class="se">\\</span><span class="s">x00])*</span><span class="se">\\</span><span class="s">)&#39;</span>
<span class="n">REG_CHAR</span> <span class="o">=</span> <span class="s">&#39;[^</span><span class="se">\\\\</span><span class="s">()</span><span class="se">\\</span><span class="s">x00-</span><span class="se">\\</span><span class="s">x20]&#39;</span>
<span class="n">IN_PARENS_NOSP</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">((&#39;</span> <span class="o">+</span> <span class="n">REG_CHAR</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;)*</span><span class="se">\\</span><span class="s">)&#39;</span>
<span class="n">TAGNAME</span> <span class="o">=</span> <span class="s">&#39;[A-Za-z][A-Za-z0-9]*&#39;</span>
<span class="n">BLOCKTAGNAME</span> <span class="o">=</span> <span class="s">&#39;(?:article|header|aside|hgroup|iframe|blockquote|hr|body|li|map|button|object|canvas|ol|caption|output|col|p|colgroup|pre|dd|progress|div|section|dl|table|td|dt|tbody|embed|textarea|fieldset|tfoot|figcaption|th|figure|thead|footer|footer|tr|form|ul|h1|h2|h3|h4|h5|h6|video|script|style)&#39;</span>
<span class="n">ATTRIBUTENAME</span> <span class="o">=</span> <span class="s">&#39;[a-zA-Z_:][a-zA-Z0-9:._-]*&#39;</span>
<span class="n">UNQUOTEDVALUE</span> <span class="o">=</span> <span class="s">&quot;[^</span><span class="se">\&quot;</span><span class="s">&#39;=&lt;&gt;`</span><span class="se">\\</span><span class="s">x00-</span><span class="se">\\</span><span class="s">x20]+&quot;</span>
<span class="n">SINGLEQUOTEDVALUE</span> <span class="o">=</span> <span class="s">&quot;&#39;[^&#39;]*&#39;&quot;</span>
<span class="n">DOUBLEQUOTEDVALUE</span> <span class="o">=</span> <span class="s">&#39;&quot;[^&quot;]*&quot;&#39;</span>
<span class="n">ATTRIBUTEVALUE</span> <span class="o">=</span> <span class="s">&quot;(?:&quot;</span> <span class="o">+</span> <span class="n">UNQUOTEDVALUE</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> \
    <span class="n">SINGLEQUOTEDVALUE</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">DOUBLEQUOTEDVALUE</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="n">ATTRIBUTEVALUESPEC</span> <span class="o">=</span> <span class="s">&quot;(?:&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*=&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*&quot;</span> <span class="o">+</span> <span class="n">ATTRIBUTEVALUE</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="n">ATTRIBUTE</span> <span class="o">=</span> <span class="s">&quot;(?:&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+&quot;</span> <span class="o">+</span> <span class="n">ATTRIBUTENAME</span> <span class="o">+</span> <span class="n">ATTRIBUTEVALUESPEC</span> <span class="o">+</span> <span class="s">&quot;?)&quot;</span>
<span class="n">OPENTAG</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">TAGNAME</span> <span class="o">+</span> <span class="n">ATTRIBUTE</span> <span class="o">+</span> <span class="s">&quot;*&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*/?&gt;&quot;</span>
<span class="n">CLOSETAG</span> <span class="o">=</span> <span class="s">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="n">TAGNAME</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*[&gt;]&quot;</span>
<span class="n">OPENBLOCKTAG</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">BLOCKTAGNAME</span> <span class="o">+</span> <span class="n">ATTRIBUTE</span> <span class="o">+</span> <span class="s">&quot;*&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*/?&gt;&quot;</span>
<span class="n">CLOSEBLOCKTAG</span> <span class="o">=</span> <span class="s">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="n">BLOCKTAGNAME</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s*[&gt;]&quot;</span>
<span class="n">HTMLCOMMENT</span> <span class="o">=</span> <span class="s">&quot;&lt;!--([^-]+|[-][^-]+)*--&gt;&quot;</span>
<span class="n">PROCESSINGINSTRUCTION</span> <span class="o">=</span> <span class="s">&quot;[&lt;][?].*?[?][&gt;]&quot;</span>
<span class="n">DECLARATION</span> <span class="o">=</span> <span class="s">&quot;&lt;![A-Z]+&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+[^&gt;]*&gt;&quot;</span>
<span class="n">CDATA</span> <span class="o">=</span> <span class="s">&quot;&lt;!</span><span class="se">\\</span><span class="s">[CDATA</span><span class="se">\\</span><span class="s">[([^</span><span class="se">\\</span><span class="s">]]+|</span><span class="se">\\</span><span class="s">][^</span><span class="se">\\</span><span class="s">]]|</span><span class="se">\\</span><span class="s">]</span><span class="se">\\</span><span class="s">][^&gt;])*</span><span class="se">\\</span><span class="s">]</span><span class="se">\\</span><span class="s">]&gt;&quot;</span>
<span class="n">HTMLTAG</span> <span class="o">=</span> <span class="s">&quot;(?:&quot;</span> <span class="o">+</span> <span class="n">OPENTAG</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">CLOSETAG</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">HTMLCOMMENT</span> <span class="o">+</span> \
    <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">PROCESSINGINSTRUCTION</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">DECLARATION</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">CDATA</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="n">HTMLBLOCKOPEN</span> <span class="o">=</span> <span class="s">&quot;&lt;(?:&quot;</span> <span class="o">+</span> <span class="n">BLOCKTAGNAME</span> <span class="o">+</span> \
    <span class="s">&quot;[</span><span class="se">\\</span><span class="s">s/&gt;]&quot;</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> \
    <span class="n">BLOCKTAGNAME</span> <span class="o">+</span> <span class="s">&quot;[</span><span class="se">\\</span><span class="s">s&gt;]&quot;</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="s">&quot;[?!])&quot;</span>

<span class="n">reHtmlTag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^&#39;</span> <span class="o">+</span> <span class="n">HTMLTAG</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">reHtmlBlockOpen</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^&#39;</span> <span class="o">+</span> <span class="n">HTMLBLOCKOPEN</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">reLinkTitle</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">&#39;^(?:&quot;(&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^&quot;</span><span class="se">\\</span><span class="s">x00])*&quot;&#39;</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^</span><span class="se">\&#39;\\</span><span class="s">x00])*</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">((&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|[^)</span><span class="se">\\</span><span class="s">x00])*</span><span class="se">\\</span><span class="s">))&#39;</span><span class="p">)</span>
<span class="n">reLinkDestinationBraces</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">&#39;^(?:[&lt;](?:[^&lt;&gt;</span><span class="se">\\</span><span class="s">n</span><span class="se">\\\\\\</span><span class="s">x00]&#39;</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">)*[&gt;])&#39;</span><span class="p">)</span>
<span class="n">reLinkDestination</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">&#39;^(?:&#39;</span> <span class="o">+</span> <span class="n">REG_CHAR</span> <span class="o">+</span> <span class="s">&#39;+|&#39;</span> <span class="o">+</span> <span class="n">ESCAPED_CHAR</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">IN_PARENS_NOSP</span> <span class="o">+</span> <span class="s">&#39;)*&#39;</span><span class="p">)</span>
<span class="n">reEscapable</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ESCAPABLE</span><span class="p">)</span>
<span class="n">reAllEscapedChar</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">ESCAPABLE</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
<span class="n">reEscapedChar</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^</span><span class="se">\\\\</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">ESCAPABLE</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
<span class="n">reAllTab</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">reHrule</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;^(?:(?:\* *){3,}|(?:_ *){3,}|(?:- *){3,}) *$&quot;</span><span class="p">)</span>

<span class="c"># Matches a character with a special meaning in markdown,</span>
<span class="c"># or a string of non-special characters.</span>
<span class="n">reMain</span> <span class="o">=</span> <span class="s">r&quot;^(?:[\n`\[\]</span><span class="se">\\</span><span class="s">!&lt;&amp;*_]|[^\n`\[\]</span><span class="se">\\</span><span class="s">!&lt;&amp;*_]+)&quot;</span>

<span class="c"># Utility functions</span>

<span class="k">def</span> <span class="nf">ASTtoJSON</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Output AST in JSON form.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">block</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">prepare</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># indent=4)</span>

<span class="k">def</span> <span class="nf">dumpAST</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Print out a block/entire AST.&quot;&quot;&quot;</span>
    <span class="n">indChar</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">*</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-&gt; &quot;</span> <span class="k">if</span> <span class="n">ind</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Info: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">destination</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Destination: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Open: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">isOpen</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Last line blank: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_line</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Start line: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">start_line</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_column</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Start Column: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">start_column</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_line</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;End line: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">end_line</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">string_content</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;String content: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">string_content</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Info: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Strings: [&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&#39;&#39;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;c:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
                <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;c: &quot;</span><span class="o">+</span><span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Label:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;List Data: &quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[type] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;bullet_char&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[bullet_char] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;bullet_char&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;start&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[start] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;delimiter&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[delimiter] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;padding&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[padding] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;marker_offset&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[marker_offset] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">inline_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Inline content:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">inline_content</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Children:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">unescape</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Replace backslash escapes with literal characters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">reAllEscapedChar</span><span class="p">,</span> <span class="s">r&quot;\g&lt;1&gt;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">isBlank</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns True if string contains only space characters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^\s*$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">normalizeReference</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Normalize reference label: collapse internal whitespace to</span>
<span class="sd">    single space, remove leading/trailing whitespace, case fold.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">matchAt</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to match a regex in string s at offset offset.</span>
<span class="sd">    Return index of match or None.&quot;&quot;&quot;</span>
    <span class="n">matched</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">matched</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">detabLine</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert tabs to spaces on each line using a 4-space tab stop.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">tabber</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;    &quot;</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">:]</span>
            <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tabber</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>


<span class="k">class</span> <span class="nc">Block</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="o">=</span><span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="n">start_column</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[],</span> <span class="n">start_line</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_column</span> <span class="o">=</span> <span class="n">start_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">InlineParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;  INLINE PARSER</span>

<span class="sd">     These are methods of an InlineParser class, defined below.</span>
<span class="sd">     An InlineParser keeps track of a subject (a string to be</span>
<span class="sd">     parsed) and a position in that subject.</span>

<span class="sd">     If re matches at current position in the subject, advance</span>
<span class="sd">     position in subject and return the match; otherwise return null.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexString</span><span class="p">,</span> <span class="n">reCompileFlags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If re matches at current position in the subject, advance</span>
<span class="sd">        position in subject and return the match; otherwise return null.&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">regexString</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:],</span> <span class="n">flags</span><span class="o">=</span><span class="n">reCompileFlags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the character at the current subject position, or null if</span>
<span class="sd">        there are no more characters.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">spnl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse zero or more space characters, including at most one newline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n *)?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c"># All of the parsers below try to match something at the current position</span>
    <span class="c"># in the subject.  If they succeed in matching anything, they</span>
    <span class="c"># push an inline element onto the &#39;inlines&#39; list.  They return the</span>
    <span class="c"># number of characters parsed (possibly 0).</span>

    <span class="k">def</span> <span class="nf">parseBackticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse backticks, adding either a backtick code span or a</span>
<span class="sd">        literal sequence of backticks to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^`+&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ticks</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">afterOpenTicks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">foundCode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">foundCode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">==</span> <span class="n">ticks</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">afterOpenTicks</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;[ \n]+&quot;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Code&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">))</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ticks</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">afterOpenTicks</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseEscaped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a backslash-escaped special character, adding either the escaped</span>
<span class="sd">        character, a hard line break (if the backslash is followed by a newline),</span>
<span class="sd">        or a literal backslash to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
        <span class="n">subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">reEscapable</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseAutoLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an autolink (URL or email in pointy brackets).&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">&quot;^&lt;([a-zA-Z0-9.!#$%&amp;&#39;*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)&gt;&quot;</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">&quot;^&lt;(?:coap|doi|javascript|aaa|aaas|about|acap|cap|cid|crid|data|dav|dict|dns|file|ftp|geo|go|gopher|h323|http|https|iax|icap|im|imap|info|ipp|iris|iris.beep|iris.xpc|iris.xpcs|iris.lwz|ldap|mailto|mid|msrp|msrps|mtqp|mupdate|news|nfs|ni|nih|nntp|opaquelocktoken|pop|pres|rtsp|service|session|shttp|sieve|sip|sips|sms|snmp|soap.beep|soap.beeps|tag|tel|telnet|tftp|thismessage|tn3270|tip|tv|urn|vemmi|ws|wss|xcon|xcon-userid|xmlrpc.beep|xmlrpc.beeps|xmpp|z39.50r|z39.50s|adiumxtra|afp|afs|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|chrome|chrome-extension|com-eventbrite-attendee|content|cvs|dlna-playsingle|dlna-playcontainer|dtn|dvb|ed2k|facetime|feed|finger|fish|gg|git|gizmoproject|gtalk|hcp|icon|ipn|irc|irc6|ircs|itms|jar|jms|keyparc|lastfm|ldaps|magnet|maps|market|message|mms|ms-help|msnim|mumble|mvn|notes|oid|palm|paparazzi|platform|proxy|psyc|query|res|resource|rmi|rsync|rtmp|secondlife|sftp|sgn|skype|smb|soldat|spotify|ssh|steam|svn|teamspeak|things|udp|unreal|ut2004|ventrilo|view-source|webcal|wtai|wyciwyg|xfire|xri|ymsgr):[^&lt;&gt;</span><span class="se">\x00</span><span class="s">-</span><span class="se">\x20</span><span class="s">]*&gt;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="c"># email</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;mailto:&quot;</span> <span class="o">+</span> <span class="n">dest</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">m2</span><span class="p">:</span>
            <span class="c"># link</span>
            <span class="n">dest2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest2</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest2</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseHtmlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a raw HTML tag.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHtmlTag</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Html&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">scanDelims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan a sequence of characters == c, and return information about</span>
<span class="sd">        the number of delimiters and whether they are positioned such that</span>
<span class="sd">        they can open and/or close emphasis or strong emphasis.  A utility</span>
<span class="sd">        function for strong/emph parsing.&quot;&quot;&quot;</span>
        <span class="n">numdelims</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">char_before</span> <span class="o">=</span> <span class="n">char_after</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>

        <span class="n">char_before</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">numdelims</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="n">char_after</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>

        <span class="n">can_open</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">))</span>
        <span class="n">can_close</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">):</span>
            <span class="n">can_open</span> <span class="o">=</span> <span class="n">can_open</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
            <span class="n">can_close</span> <span class="o">=</span> <span class="n">can_close</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&quot;numdelims&quot;</span><span class="p">:</span> <span class="n">numdelims</span><span class="p">,</span>
            <span class="s">&quot;can_open&quot;</span><span class="p">:</span> <span class="n">can_open</span><span class="p">,</span>
            <span class="s">&quot;can_close&quot;</span><span class="p">:</span> <span class="n">can_close</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">parseEmphasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse emphasis or strong emphasis in an efficient way,</span>
<span class="sd">        with no backtracking.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">first_close</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">nxt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">numdelims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">numdelims</span>
        <span class="k">if</span> <span class="n">startpos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span> <span class="o">+</span> <span class="n">startpos</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span><span class="p">]))</span>
        <span class="n">delimpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_open&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                            <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                            <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">first_close_delims</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">first_close</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">inlines</span><span class="p">[</span>
                            <span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Emph&quot;</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Strong&quot;</span>
                        <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">first_close</span><span class="p">])]</span> <span class="o">+</span> <span class="n">inlines</span><span class="p">[</span>
                            <span class="n">first_close</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c"># error on 362?</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                                <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]))</span>
                        <span class="n">first_close</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseLinkTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse link title (sans quotes), returning the string</span>
<span class="sd">        or null if no match.&quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkTitle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">parseLinkDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse link destination, returning the string or</span>
<span class="sd">        null if no match.&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestinationBraces</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestination</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">parseLinkLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link label, returning number of characters parsed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">nest_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">([])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span>
                    <span class="p">[])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
                <span class="n">nest_level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
                <span class="n">nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">([])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="n">nest_level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseRawLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse raw link label, including surrounding [], and return</span>
<span class="sd">        inline contents.  (Note:  this is not a method of InlineParser.)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">InlineParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">parseLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link.  If successful, add the link to</span>
<span class="sd">        inlines.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">afterlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">startpos</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">startpos</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;(&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\)&quot;</span><span class="p">):</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                        <span class="k">return</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                    <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="n">savepos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
        <span class="n">beforelabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">beforelabel</span><span class="p">:</span><span class="n">beforelabel</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">savepos</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
        <span class="k">if</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">[</span><span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;destination&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;destination&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an entity, adding to inlines if successful.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">r&quot;^&amp;(?:#x[a-f0-9]{1,8}|#[0-9]{1,8}|[a-z][a-z0-9]{1,31});&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Entity&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a run of ordinary characters, or a single character with</span>
<span class="sd">        a special meaning in markdown, as a plain string, adding to inlines.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reMain</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseNewline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a newline.  If it was preceded by two spaces, return a hard</span>
<span class="sd">        line break; otherwise a soft line break.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;  &quot;</span><span class="p">:</span>
                <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Softbreak&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an image.  If the opening &#39;!&#39; is not followed</span>
<span class="sd">        by a link, add a literal &#39;!&#39; to inlines.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^!&quot;</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;!&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">)):</span>
                <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Image&quot;</span>
                <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t happen&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link reference, modifying refmap.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>

        <span class="n">matchChars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">matchChars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[:</span><span class="n">matchChars</span><span class="p">]</span>

        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="s">&quot;:&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>

        <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">beforetitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">beforetitle</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n|$)&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">normlabel</span> <span class="o">=</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">refmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normlabel</span><span class="p">,</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="n">refmap</span><span class="p">[</span><span class="n">normlabel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;destination&quot;</span><span class="p">:</span> <span class="n">dest</span><span class="p">,</span>
                <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse the next inline element in subject, advancing subject position</span>
<span class="sd">        and adding the result to &#39;inlines&#39;.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseNewline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEmphasis</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;!&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseImage</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEntity</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; Parse s as a list of inlines, using refmap to resolve references.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="n">refmap</span>
        <span class="n">inlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">inlines</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; Pass through to parseInlines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInlines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DocParser</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span> <span class="o">=</span> <span class="n">InlineParser</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">acceptsLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if block type can accept lines of text.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span>

    <span class="k">def</span> <span class="nf">endsWithBlankLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if block ends with a blank line, descending if needed</span>
<span class="sd">        into lists and sublists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">breakOutOfLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Break out of all containing lists, resetting the tip of the</span>
<span class="sd">        document to the parent of the highest list, and finalizing</span>
<span class="sd">        all the lists.  (This is used to implement the &quot;two blank lines</span>
<span class="sd">        break of of all lists&quot; feature.)&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">block</span>
        <span class="n">last_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
                <span class="n">last_list</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">last_list</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span> <span class="o">==</span> <span class="n">last_list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">last_list</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">last_list</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">def</span> <span class="nf">addLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a line to the block at the tip.  We assume the tip</span>
<span class="sd">        can accept lines -- that check should be done before calling this.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s">&quot;Attempted to add line (&quot;</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">+</span> <span class="s">&quot;) to closed container.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add block of type tag as a child of the tip.  If the tip can&#39;t</span>
<span class="sd">        accept children, close and finalize it and try its parent,</span>
<span class="sd">        and so on til we find a block that can accept children.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
        <span class="n">column_number</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">newBlock</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">column_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBlock</span><span class="p">)</span>
        <span class="n">newBlock</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">newBlock</span>
        <span class="k">return</span> <span class="n">newBlock</span>

    <span class="k">def</span> <span class="nf">listsMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_data</span><span class="p">,</span> <span class="n">item_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if the two list items are of the same type,</span>
<span class="sd">        with the same delimiter and bullet character.  This is used</span>
<span class="sd">        in agglomerating list items into lists.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">parseListMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a list marker and return data on the marker (type,</span>
<span class="sd">        start, delimiter, bullet character, padding) or null.&quot;&quot;&quot;</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">blank_item</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^[*+-]( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">match2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^(\d+)([.)])( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Bullet&#39;</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;bullet_char&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
            <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Ordered&#39;</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">spaces_after_marker</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">spaces_after_marker</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">blank_item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">incorporateLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Analyze a line of text and update the document appropriately.</span>
<span class="sd">        We parse markdown text by calling this on each line of input,</span>
<span class="sd">        then finalizing the document.&quot;&quot;&quot;</span>
        <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">CODE_INDENT</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">blank</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">already_done</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="n">oldtip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>

        <span class="n">ln</span> <span class="o">=</span> <span class="n">detabLine</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">last_child</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_child</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">last_child</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">matched</span>
                <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]):</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
                        <span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">]:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">offset</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">all_matched</span><span class="p">:</span>
                <span class="n">container</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">break</span>
        <span class="n">last_matched_container</span> <span class="o">=</span> <span class="n">container</span>

        <span class="k">def</span> <span class="nf">closeUnmatchedBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; This function is used to finalize and close any unmatched</span>
<span class="sd">            blocks.  We aren&#39;t ready to do this now, because we might</span>
<span class="sd">            have a lazy paragraph continuation, in which case we don&#39;t</span>
<span class="sd">            want to close unmatched blocks.  So we store this closure for</span>
<span class="sd">            use later, when we have more information.&quot;&quot;&quot;</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">already_done</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">oldtip</span> <span class="o">==</span> <span class="n">last_matched_container</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">oldtip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="n">oldtip</span> <span class="o">=</span> <span class="n">oldtip</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">oldtip</span>

        <span class="k">if</span> <span class="n">blank</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakOutOfLists</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;^[ #`~*+_=&lt;&gt;0-9-]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ATXmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^#{1,6}(?: +|$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="s">r&quot;^`{3,}(?!.*`)|^~{3,}(?!.*~)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">PARmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^(?:=+|-+) *$&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseListMarker</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>

            <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
                    <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&#39;IndentedCode&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">&quot;BlockQuote&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ATXmatch</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">#&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">FENmatch</span><span class="p">:</span>
                <span class="n">fence_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;FencedCode&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span> <span class="o">=</span> <span class="n">fence_length</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="o">=</span> <span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">fence_length</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHtmlBlockOpen</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&#39;HtmlBlock&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">PARmatch</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;SetextHeader&quot;</span>
                <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">PARmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;=&#39;</span> <span class="k">else</span> <span class="mi">2</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;HorizontalRule&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indent</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">listsMatch</span><span class="p">(</span>
                   <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&quot;List&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;ListItem&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                <span class="k">break</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">==</span> <span class="n">last_matched_container</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="n">blank</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">start_line</span> <span class="o">==</span> <span class="n">line_number</span><span class="p">))</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">container</span>
            <span class="k">while</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">match</span>
                <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]:</span>
                <span class="c"># nothing to do; we already added the contents.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">:</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># print(&quot;Line &quot; + str(line_number) +</span>
                    <span class="c">#       &quot; with container type &quot; +</span>
                    <span class="c">#       container.t + &quot; did not match any condition.&quot;)</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finalize a block.  Close it and do any necessary postprocessing,</span>
<span class="sd">        e.g. creating string_content from strings, setting the &#39;tight&#39;</span>
<span class="sd">        or &#39;loose&#39; status of a list, and parsing the beginnings</span>
<span class="sd">        of paragraphs for reference definitions.  Reset the tip to the</span>
<span class="sd">        parent of the closed block.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line_number</span> <span class="o">&gt;</span> <span class="n">block</span><span class="o">.</span><span class="n">start_line</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;^  *&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span> <span class="ow">and</span> <span class="n">pos</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isBlank</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;ReferenceDef&quot;</span>
                    <span class="k">break</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s">r&quot;(\n *)*$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">numitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">numitems</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">last_item</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">numitems</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last_item</span><span class="p">):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
                <span class="n">numsubitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">numsubitems</span><span class="p">):</span>
                    <span class="n">subitem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">last_subitem</span> <span class="o">=</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">numsubitems</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span> <span class="ow">and</span>
                       <span class="ow">not</span> <span class="p">(</span><span class="n">last_item</span> <span class="ow">and</span> <span class="n">last_subitem</span><span class="p">)):</span>
                        <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">def</span> <span class="nf">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Walk through a block &amp; children recursively, parsing string content</span>
<span class="sd">        into inline content where appropriate.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">]:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main parsing function.  Returns a parsed document AST.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;\r\n|\n|\r&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\n$&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incorporateLine</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>


<span class="k">class</span> <span class="nc">HTMLRenderer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">blocksep</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">innersep</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">softbreak</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">escape_pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;[&amp;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&quot;[&lt;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&quot;[&gt;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;[&quot;]&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;quot;&#39;</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attribs</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">selfclosing</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Helper function to produce content in a pair of HTML tags.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">tag</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">attrib</span> <span class="o">=</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">contents</span> <span class="o">+</span> <span class="s">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">selfclosing</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s">&quot; /&gt;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">URLescape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Escape href URLs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;mailto|MAILTO&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">preserve_entities</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Escape HTML entities.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">preserve_entities</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span>
                <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">renderInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render an inline element as HTML.&quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Softbreak&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">softbreak</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Hardbreak&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;br&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Emph&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;em&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Strong&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;strong&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Html&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Entity&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;nbsp;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot; &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">URLescape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">)]]</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">,</span> <span class="bp">True</span><span class="p">)],</span> <span class="p">[</span>
                     <span class="s">&#39;alt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))]]</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Code&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown inline type &quot;</span> <span class="o">+</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">renderInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a list of inlines.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">renderBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a single block element.&quot;&quot;&quot;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">info_words</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span><span class="p">):</span>
            <span class="n">whole_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">in_tight_list</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">):</span>
            <span class="n">filling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filling</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;blockquote&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="p">[],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span>
                                                 <span class="n">in_tight_list</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Bullet&quot;</span><span class="p">):</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ul&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ol&quot;</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
                <span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[[</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">tight</span><span class="p">)</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ATXHeader&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">)):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;h&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">[],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                                       <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
            <span class="n">info_words</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                <span class="n">info_words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot; +&quot;</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[</span>
                <span class="p">[</span><span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;language-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">info_words</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">True</span><span class="p">)]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                               <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;hr&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown block type&quot;</span> <span class="o">+</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">renderBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a list of block elements, separated by this.blocksep.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">in_tight_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocksep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass through for renderBlock&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">)</span>
</pre></div>

    </div>

  <hr>

  <h2>Index</h2>

  <ul id="index">
    <li><h4><a href="#header-variables">Module variables</a></h4>
      
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.ATTRIBUTE">ATTRIBUTE</a></li>
          <li class="mono"><a href="#CommonMark.ATTRIBUTENAME">ATTRIBUTENAME</a></li>
          <li class="mono"><a href="#CommonMark.ATTRIBUTEVALUE">ATTRIBUTEVALUE</a></li>
          <li class="mono"><a href="#CommonMark.ATTRIBUTEVALUESPEC">ATTRIBUTEVALUESPEC</a></li>
          <li class="mono"><a href="#CommonMark.BLOCKTAGNAME">BLOCKTAGNAME</a></li>
          <li class="mono"><a href="#CommonMark.CDATA">CDATA</a></li>
          <li class="mono"><a href="#CommonMark.CLOSEBLOCKTAG">CLOSEBLOCKTAG</a></li>
          <li class="mono"><a href="#CommonMark.CLOSETAG">CLOSETAG</a></li>
          <li class="mono"><a href="#CommonMark.DECLARATION">DECLARATION</a></li>
          <li class="mono"><a href="#CommonMark.DOUBLEQUOTEDVALUE">DOUBLEQUOTEDVALUE</a></li>
          <li class="mono"><a href="#CommonMark.ESCAPABLE">ESCAPABLE</a></li>
          <li class="mono"><a href="#CommonMark.ESCAPED_CHAR">ESCAPED_CHAR</a></li>
          <li class="mono"><a href="#CommonMark.HTMLBLOCKOPEN">HTMLBLOCKOPEN</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.HTMLCOMMENT">HTMLCOMMENT</a></li>
          <li class="mono"><a href="#CommonMark.HTMLTAG">HTMLTAG</a></li>
          <li class="mono"><a href="#CommonMark.IN_DOUBLE_QUOTES">IN_DOUBLE_QUOTES</a></li>
          <li class="mono"><a href="#CommonMark.IN_PARENS">IN_PARENS</a></li>
          <li class="mono"><a href="#CommonMark.IN_PARENS_NOSP">IN_PARENS_NOSP</a></li>
          <li class="mono"><a href="#CommonMark.IN_SINGLE_QUOTES">IN_SINGLE_QUOTES</a></li>
          <li class="mono"><a href="#CommonMark.OPENBLOCKTAG">OPENBLOCKTAG</a></li>
          <li class="mono"><a href="#CommonMark.OPENTAG">OPENTAG</a></li>
          <li class="mono"><a href="#CommonMark.PROCESSINGINSTRUCTION">PROCESSINGINSTRUCTION</a></li>
          <li class="mono"><a href="#CommonMark.REG_CHAR">REG_CHAR</a></li>
          <li class="mono"><a href="#CommonMark.SINGLEQUOTEDVALUE">SINGLEQUOTEDVALUE</a></li>
          <li class="mono"><a href="#CommonMark.TAGNAME">TAGNAME</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.UNQUOTEDVALUE">UNQUOTEDVALUE</a></li>
          <li class="mono"><a href="#CommonMark.reAllEscapedChar">reAllEscapedChar</a></li>
          <li class="mono"><a href="#CommonMark.reAllTab">reAllTab</a></li>
          <li class="mono"><a href="#CommonMark.reEscapable">reEscapable</a></li>
          <li class="mono"><a href="#CommonMark.reEscapedChar">reEscapedChar</a></li>
          <li class="mono"><a href="#CommonMark.reHrule">reHrule</a></li>
          <li class="mono"><a href="#CommonMark.reHtmlBlockOpen">reHtmlBlockOpen</a></li>
          <li class="mono"><a href="#CommonMark.reHtmlTag">reHtmlTag</a></li>
          <li class="mono"><a href="#CommonMark.reLinkDestination">reLinkDestination</a></li>
          <li class="mono"><a href="#CommonMark.reLinkDestinationBraces">reLinkDestinationBraces</a></li>
          <li class="mono"><a href="#CommonMark.reLinkTitle">reLinkTitle</a></li>
          <li class="mono"><a href="#CommonMark.reMain">reMain</a></li>
      </ul>
  </div>

    </li>

    <li><h4><a href="#header-functions">Functions</a></h4>
      
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.ASTtoJSON">ASTtoJSON</a></li>
          <li class="mono"><a href="#CommonMark.detabLine">detabLine</a></li>
          <li class="mono"><a href="#CommonMark.dumpAST">dumpAST</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.isBlank">isBlank</a></li>
          <li class="mono"><a href="#CommonMark.matchAt">matchAt</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.normalizeReference">normalizeReference</a></li>
          <li class="mono"><a href="#CommonMark.unescape">unescape</a></li>
      </ul>
  </div>

    </li>

    <li><h4><a href="#header-classes">Classes</a></h4>
      <ul>
          <li class="mono">
            <span class="class_name"><a href="#CommonMark.Block">Block</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.Block.makeBlock">makeBlock</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.Block.__init__">__init__</a></li>
      </ul>
      <ul>
      </ul>
  </div>

          </li>
          <li class="mono">
            <span class="class_name"><a href="#CommonMark.DocParser">DocParser</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.DocParser.__init__">__init__</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.acceptsLines">acceptsLines</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.addChild">addChild</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.addLine">addLine</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.DocParser.breakOutOfLists">breakOutOfLists</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.endsWithBlankLine">endsWithBlankLine</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.finalize">finalize</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.incorporateLine">incorporateLine</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.DocParser.listsMatch">listsMatch</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.parse">parse</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.parseListMarker">parseListMarker</a></li>
          <li class="mono"><a href="#CommonMark.DocParser.processInlines">processInlines</a></li>
      </ul>
  </div>

          </li>
          <li class="mono">
            <span class="class_name"><a href="#CommonMark.HTMLRenderer">HTMLRenderer</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.inTags">inTags</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.__init__">__init__</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.URLescape">URLescape</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.escape">escape</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.render">render</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.renderBlock">renderBlock</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.renderBlocks">renderBlocks</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.renderInline">renderInline</a></li>
          <li class="mono"><a href="#CommonMark.HTMLRenderer.renderInlines">renderInlines</a></li>
      </ul>
  </div>

          </li>
          <li class="mono">
            <span class="class_name"><a href="#CommonMark.InlineParser">InlineParser</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#CommonMark.InlineParser.__init__">__init__</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.match">match</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parse">parse</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseAutoLink">parseAutoLink</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseBackticks">parseBackticks</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseEmphasis">parseEmphasis</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseEntity">parseEntity</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseEscaped">parseEscaped</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.InlineParser.parseHtmlTag">parseHtmlTag</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseImage">parseImage</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseInline">parseInline</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseInlines">parseInlines</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseLink">parseLink</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseLinkDestination">parseLinkDestination</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseLinkLabel">parseLinkLabel</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseLinkTitle">parseLinkTitle</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#CommonMark.InlineParser.parseNewline">parseNewline</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseRawLabel">parseRawLabel</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseReference">parseReference</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.parseString">parseString</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.peek">peek</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.scanDelims">scanDelims</a></li>
          <li class="mono"><a href="#CommonMark.InlineParser.spnl">spnl</a></li>
      </ul>
  </div>

          </li>
      </ul>
    </li>

  </ul>

  <h2 id="header-variables">Module variables</h2>
      <div class="item">
        <p id="CommonMark.ATTRIBUTE" class="name">var <span class="ident">ATTRIBUTE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.ATTRIBUTENAME" class="name">var <span class="ident">ATTRIBUTENAME</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.ATTRIBUTEVALUE" class="name">var <span class="ident">ATTRIBUTEVALUE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.ATTRIBUTEVALUESPEC" class="name">var <span class="ident">ATTRIBUTEVALUESPEC</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.BLOCKTAGNAME" class="name">var <span class="ident">BLOCKTAGNAME</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.CDATA" class="name">var <span class="ident">CDATA</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.CLOSEBLOCKTAG" class="name">var <span class="ident">CLOSEBLOCKTAG</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.CLOSETAG" class="name">var <span class="ident">CLOSETAG</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.DECLARATION" class="name">var <span class="ident">DECLARATION</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.DOUBLEQUOTEDVALUE" class="name">var <span class="ident">DOUBLEQUOTEDVALUE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.ESCAPABLE" class="name">var <span class="ident">ESCAPABLE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.ESCAPED_CHAR" class="name">var <span class="ident">ESCAPED_CHAR</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.HTMLBLOCKOPEN" class="name">var <span class="ident">HTMLBLOCKOPEN</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.HTMLCOMMENT" class="name">var <span class="ident">HTMLCOMMENT</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.HTMLTAG" class="name">var <span class="ident">HTMLTAG</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.IN_DOUBLE_QUOTES" class="name">var <span class="ident">IN_DOUBLE_QUOTES</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.IN_PARENS" class="name">var <span class="ident">IN_PARENS</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.IN_PARENS_NOSP" class="name">var <span class="ident">IN_PARENS_NOSP</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.IN_SINGLE_QUOTES" class="name">var <span class="ident">IN_SINGLE_QUOTES</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.OPENBLOCKTAG" class="name">var <span class="ident">OPENBLOCKTAG</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.OPENTAG" class="name">var <span class="ident">OPENTAG</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.PROCESSINGINSTRUCTION" class="name">var <span class="ident">PROCESSINGINSTRUCTION</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.REG_CHAR" class="name">var <span class="ident">REG_CHAR</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.SINGLEQUOTEDVALUE" class="name">var <span class="ident">SINGLEQUOTEDVALUE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.TAGNAME" class="name">var <span class="ident">TAGNAME</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.UNQUOTEDVALUE" class="name">var <span class="ident">UNQUOTEDVALUE</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reAllEscapedChar" class="name">var <span class="ident">reAllEscapedChar</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reAllTab" class="name">var <span class="ident">reAllTab</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reEscapable" class="name">var <span class="ident">reEscapable</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reEscapedChar" class="name">var <span class="ident">reEscapedChar</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reHrule" class="name">var <span class="ident">reHrule</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reHtmlBlockOpen" class="name">var <span class="ident">reHtmlBlockOpen</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reHtmlTag" class="name">var <span class="ident">reHtmlTag</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reLinkDestination" class="name">var <span class="ident">reLinkDestination</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reLinkDestinationBraces" class="name">var <span class="ident">reLinkDestinationBraces</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reLinkTitle" class="name">var <span class="ident">reLinkTitle</span></p>
        
  
    <div class="source_cont">
</div>

      </div>
      <div class="item">
        <p id="CommonMark.reMain" class="name">var <span class="ident">reMain</span></p>
        
  
    <div class="source_cont">
</div>

      </div>

  <h2 id="header-functions">Functions</h2>
      
    <div class="item">
      <div class="name def" id="CommonMark.ASTtoJSON">
        <p>def <span class="ident">ASTtoJSON</span>(</p><p>block)</p>
      </div>
      

      
  
      <div class="desc"><p>Output AST in JSON form.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.ASTtoJSON', this);">Show source.</a></p>
    <div id="source-CommonMark.ASTtoJSON" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">ASTtoJSON</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Output AST in JSON form.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">block</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">prepare</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># indent=4)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.detabLine">
        <p>def <span class="ident">detabLine</span>(</p><p>text)</p>
      </div>
      

      
  
      <div class="desc"><p>Convert tabs to spaces on each line using a 4-space tab stop.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.detabLine', this);">Show source.</a></p>
    <div id="source-CommonMark.detabLine" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">detabLine</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert tabs to spaces on each line using a 4-space tab stop.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">tabber</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;    &quot;</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">:]</span>
            <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">tabber</span><span class="o">.</span><span class="n">lastStop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tabber</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.dumpAST">
        <p>def <span class="ident">dumpAST</span>(</p><p>obj, ind=0)</p>
      </div>
      

      
  
      <div class="desc"><p>Print out a block/entire AST.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.dumpAST', this);">Show source.</a></p>
    <div id="source-CommonMark.dumpAST" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">dumpAST</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Print out a block/entire AST.&quot;&quot;&quot;</span>
    <span class="n">indChar</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">*</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-&gt; &quot;</span> <span class="k">if</span> <span class="n">ind</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Info: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">destination</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Destination: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Open: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">isOpen</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Last line blank: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_line</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Start line: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">start_line</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_column</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Start Column: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">start_column</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_line</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;End line: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">end_line</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">string_content</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;String content: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">string_content</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Info: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Strings: [&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&#39;&#39;]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;c:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
                <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;c: &quot;</span><span class="o">+</span><span class="n">obj</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Label:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;List Data: &quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[type] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;bullet_char&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[bullet_char] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;bullet_char&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;start&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[start] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;delimiter&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[delimiter] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;padding&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[padding] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="s">&quot;marker_offset&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;[marker_offset] = &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">inline_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Inline content:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">inline_content</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indChar</span> <span class="o">+</span> <span class="s">&quot;Children:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">dumpAST</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.isBlank">
        <p>def <span class="ident">isBlank</span>(</p><p>s)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns True if string contains only space characters.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.isBlank', this);">Show source.</a></p>
    <div id="source-CommonMark.isBlank" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">isBlank</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns True if string contains only space characters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^\s*$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.matchAt">
        <p>def <span class="ident">matchAt</span>(</p><p>pattern, s, offset)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to match a regex in string s at offset offset.
Return index of match or None.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.matchAt', this);">Show source.</a></p>
    <div id="source-CommonMark.matchAt" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">matchAt</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to match a regex in string s at offset offset.</span>
<span class="sd">    Return index of match or None.&quot;&quot;&quot;</span>
    <span class="n">matched</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">matched</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.normalizeReference">
        <p>def <span class="ident">normalizeReference</span>(</p><p>s)</p>
      </div>
      

      
  
      <div class="desc"><p>Normalize reference label: collapse internal whitespace to
single space, remove leading/trailing whitespace, case fold.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.normalizeReference', this);">Show source.</a></p>
    <div id="source-CommonMark.normalizeReference" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">normalizeReference</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Normalize reference label: collapse internal whitespace to</span>
<span class="sd">    single space, remove leading/trailing whitespace, case fold.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="CommonMark.unescape">
        <p>def <span class="ident">unescape</span>(</p><p>s)</p>
      </div>
      

      
  
      <div class="desc"><p>Replace backslash escapes with literal characters.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.unescape', this);">Show source.</a></p>
    <div id="source-CommonMark.unescape" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">unescape</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Replace backslash escapes with literal characters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">reAllEscapedChar</span><span class="p">,</span> <span class="s">r&quot;\g&lt;1&gt;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  

  <h2 id="header-classes">Classes</h2>
      
      <div class="item">
        <p id="CommonMark.Block" class="name">class <span class="ident">Block</span></p>
        
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.Block', this);">Show source.</a></p>
    <div id="source-CommonMark.Block" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Block</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="o">=</span><span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="n">start_column</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[],</span> <span class="n">start_line</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_column</span> <span class="o">=</span> <span class="n">start_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#CommonMark.Block">Block</a></li>
                <li>__builtin__.object</li>
              </ul>
              <h4>Static methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.Block.makeBlock">
        <p>def <span class="ident">makeBlock</span>(</p><p>tag, start_line, start_column)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.Block.makeBlock', this);">Show source.</a></p>
    <div id="source-CommonMark.Block.makeBlock" class="source">
      <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">start_line</span><span class="o">=</span><span class="n">start_line</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="n">start_column</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
              <h4>Instance variables</h4>
                  <div class="item">
                    <p id="CommonMark.Block.c" class="name">var <span class="ident">c</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.children" class="name">var <span class="ident">children</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.destination" class="name">var <span class="ident">destination</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.end_line" class="name">var <span class="ident">end_line</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.info" class="name">var <span class="ident">info</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.inline_content" class="name">var <span class="ident">inline_content</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.isOpen" class="name">var <span class="ident">isOpen</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.label" class="name">var <span class="ident">label</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.last_line_blank" class="name">var <span class="ident">last_line_blank</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.list_data" class="name">var <span class="ident">list_data</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.parent" class="name">var <span class="ident">parent</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.start_column" class="name">var <span class="ident">start_column</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.start_line" class="name">var <span class="ident">start_line</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.string_content" class="name">var <span class="ident">string_content</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.strings" class="name">var <span class="ident">strings</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.t" class="name">var <span class="ident">t</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.tight" class="name">var <span class="ident">tight</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.Block.title" class="name">var <span class="ident">title</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.Block.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self, t=&#39;&#39;, c=&#39;&#39;, destination=&#39;&#39;, label=[], start_line=&#39;&#39;, start_column=&#39;&#39;, title=&#39;&#39;)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.Block.__init__', this);">Show source.</a></p>
    <div id="source-CommonMark.Block.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[],</span> <span class="n">start_line</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_column</span> <span class="o">=</span> <span class="n">start_column</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">start_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>
      
      <div class="item">
        <p id="CommonMark.DocParser" class="name">class <span class="ident">DocParser</span></p>
        
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">DocParser</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span> <span class="o">=</span> <span class="n">InlineParser</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">acceptsLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if block type can accept lines of text.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span>

    <span class="k">def</span> <span class="nf">endsWithBlankLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if block ends with a blank line, descending if needed</span>
<span class="sd">        into lists and sublists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">breakOutOfLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Break out of all containing lists, resetting the tip of the</span>
<span class="sd">        document to the parent of the highest list, and finalizing</span>
<span class="sd">        all the lists.  (This is used to implement the &quot;two blank lines</span>
<span class="sd">        break of of all lists&quot; feature.)&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">block</span>
        <span class="n">last_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
                <span class="n">last_list</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">last_list</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span> <span class="o">==</span> <span class="n">last_list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">last_list</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">last_list</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">def</span> <span class="nf">addLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a line to the block at the tip.  We assume the tip</span>
<span class="sd">        can accept lines -- that check should be done before calling this.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s">&quot;Attempted to add line (&quot;</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">+</span> <span class="s">&quot;) to closed container.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add block of type tag as a child of the tip.  If the tip can&#39;t</span>
<span class="sd">        accept children, close and finalize it and try its parent,</span>
<span class="sd">        and so on til we find a block that can accept children.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
        <span class="n">column_number</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">newBlock</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">column_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBlock</span><span class="p">)</span>
        <span class="n">newBlock</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">newBlock</span>
        <span class="k">return</span> <span class="n">newBlock</span>

    <span class="k">def</span> <span class="nf">listsMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_data</span><span class="p">,</span> <span class="n">item_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if the two list items are of the same type,</span>
<span class="sd">        with the same delimiter and bullet character.  This is used</span>
<span class="sd">        in agglomerating list items into lists.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">parseListMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a list marker and return data on the marker (type,</span>
<span class="sd">        start, delimiter, bullet character, padding) or null.&quot;&quot;&quot;</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">blank_item</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^[*+-]( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">match2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^(\d+)([.)])( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Bullet&#39;</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;bullet_char&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
            <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Ordered&#39;</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">spaces_after_marker</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">spaces_after_marker</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">blank_item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">incorporateLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Analyze a line of text and update the document appropriately.</span>
<span class="sd">        We parse markdown text by calling this on each line of input,</span>
<span class="sd">        then finalizing the document.&quot;&quot;&quot;</span>
        <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">CODE_INDENT</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">blank</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">already_done</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="n">oldtip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>

        <span class="n">ln</span> <span class="o">=</span> <span class="n">detabLine</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">last_child</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last_child</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">last_child</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">matched</span>
                <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]):</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
                        <span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">]:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">offset</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">all_matched</span><span class="p">:</span>
                <span class="n">container</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">break</span>
        <span class="n">last_matched_container</span> <span class="o">=</span> <span class="n">container</span>

        <span class="k">def</span> <span class="nf">closeUnmatchedBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; This function is used to finalize and close any unmatched</span>
<span class="sd">            blocks.  We aren&#39;t ready to do this now, because we might</span>
<span class="sd">            have a lazy paragraph continuation, in which case we don&#39;t</span>
<span class="sd">            want to close unmatched blocks.  So we store this closure for</span>
<span class="sd">            use later, when we have more information.&quot;&quot;&quot;</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">already_done</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">oldtip</span> <span class="o">==</span> <span class="n">last_matched_container</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">oldtip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="n">oldtip</span> <span class="o">=</span> <span class="n">oldtip</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">oldtip</span>

        <span class="k">if</span> <span class="n">blank</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakOutOfLists</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;^[ #`~*+_=&lt;&gt;0-9-]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
                <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ATXmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^#{1,6}(?: +|$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="s">r&quot;^`{3,}(?!.*`)|^~{3,}(?!.*~)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">PARmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^(?:=+|-+) *$&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseListMarker</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>

            <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
                    <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&#39;IndentedCode&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">&quot;BlockQuote&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ATXmatch</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">#&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">FENmatch</span><span class="p">:</span>
                <span class="n">fence_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;FencedCode&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span> <span class="o">=</span> <span class="n">fence_length</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="o">=</span> <span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">fence_length</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHtmlBlockOpen</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&#39;HtmlBlock&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">PARmatch</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;SetextHeader&quot;</span>
                <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">PARmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;=&#39;</span> <span class="k">else</span> <span class="mi">2</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;HorizontalRule&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indent</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">listsMatch</span><span class="p">(</span>
                   <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&quot;List&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                    <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;ListItem&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                <span class="k">break</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">==</span> <span class="n">last_matched_container</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="n">blank</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">start_line</span> <span class="o">==</span> <span class="n">line_number</span><span class="p">))</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">container</span>
            <span class="k">while</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">match</span>
                <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]:</span>
                <span class="c"># nothing to do; we already added the contents.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">:</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                        <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># print(&quot;Line &quot; + str(line_number) +</span>
                    <span class="c">#       &quot; with container type &quot; +</span>
                    <span class="c">#       container.t + &quot; did not match any condition.&quot;)</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finalize a block.  Close it and do any necessary postprocessing,</span>
<span class="sd">        e.g. creating string_content from strings, setting the &#39;tight&#39;</span>
<span class="sd">        or &#39;loose&#39; status of a list, and parsing the beginnings</span>
<span class="sd">        of paragraphs for reference definitions.  Reset the tip to the</span>
<span class="sd">        parent of the closed block.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line_number</span> <span class="o">&gt;</span> <span class="n">block</span><span class="o">.</span><span class="n">start_line</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;^  *&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span> <span class="ow">and</span> <span class="n">pos</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isBlank</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;ReferenceDef&quot;</span>
                    <span class="k">break</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s">r&quot;(\n *)*$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">numitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">numitems</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">last_item</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">numitems</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last_item</span><span class="p">):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
                <span class="n">numsubitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">numsubitems</span><span class="p">):</span>
                    <span class="n">subitem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">last_subitem</span> <span class="o">=</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">numsubitems</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span> <span class="ow">and</span>
                       <span class="ow">not</span> <span class="p">(</span><span class="n">last_item</span> <span class="ow">and</span> <span class="n">last_subitem</span><span class="p">)):</span>
                        <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">def</span> <span class="nf">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Walk through a block &amp; children recursively, parsing string content</span>
<span class="sd">        into inline content where appropriate.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">]:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main parsing function.  Returns a parsed document AST.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;\r\n|\n|\r&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\n$&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incorporateLine</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#CommonMark.DocParser">DocParser</a></li>
              </ul>
              <h4>Instance variables</h4>
                  <div class="item">
                    <p id="CommonMark.DocParser.doc" class="name">var <span class="ident">doc</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.DocParser.inlineParser" class="name">var <span class="ident">inlineParser</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.DocParser.pos" class="name">var <span class="ident">pos</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.DocParser.refmap" class="name">var <span class="ident">refmap</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.DocParser.subject" class="name">var <span class="ident">subject</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.DocParser.tip" class="name">var <span class="ident">tip</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self, subject=None, pos=0)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.__init__', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span> <span class="o">=</span> <span class="n">InlineParser</span><span class="p">()</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.acceptsLines">
        <p>def <span class="ident">acceptsLines</span>(</p><p>self, block_type)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns true if block type can accept lines of text.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.acceptsLines', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.acceptsLines" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">acceptsLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns true if block type can accept lines of text.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.addChild">
        <p>def <span class="ident">addChild</span>(</p><p>self, tag, line_number, offset)</p>
      </div>
      

      
  
      <div class="desc"><p>Add block of type tag as a child of the tip.  If the tip can't
accept children, close and finalize it and try its parent,
and so on til we find a block that can accept children.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.addChild', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.addChild" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add block of type tag as a child of the tip.  If the tip can&#39;t</span>
<span class="sd">    accept children, close and finalize it and try its parent,</span>
<span class="sd">    and so on til we find a block that can accept children.&quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
    <span class="n">column_number</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">newBlock</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">column_number</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBlock</span><span class="p">)</span>
    <span class="n">newBlock</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">newBlock</span>
    <span class="k">return</span> <span class="n">newBlock</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.addLine">
        <p>def <span class="ident">addLine</span>(</p><p>self, ln, offset)</p>
      </div>
      

      
  
      <div class="desc"><p>Add a line to the block at the tip.  We assume the tip
can accept lines -- that check should be done before calling this.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.addLine', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.addLine" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">addLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add a line to the block at the tip.  We assume the tip</span>
<span class="sd">    can accept lines -- that check should be done before calling this.&quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s">&quot;Attempted to add line (&quot;</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">+</span> <span class="s">&quot;) to closed container.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.breakOutOfLists">
        <p>def <span class="ident">breakOutOfLists</span>(</p><p>self, block, line_number)</p>
      </div>
      

      
  
      <div class="desc"><p>Break out of all containing lists, resetting the tip of the
document to the parent of the highest list, and finalizing
all the lists.  (This is used to implement the "two blank lines
break of of all lists" feature.)</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.breakOutOfLists', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.breakOutOfLists" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">breakOutOfLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Break out of all containing lists, resetting the tip of the</span>
<span class="sd">    document to the parent of the highest list, and finalizing</span>
<span class="sd">    all the lists.  (This is used to implement the &quot;two blank lines</span>
<span class="sd">    break of of all lists&quot; feature.)&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">block</span>
    <span class="n">last_list</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
            <span class="n">last_list</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">last_list</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span> <span class="o">==</span> <span class="n">last_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">last_list</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">last_list</span><span class="o">.</span><span class="n">parent</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.endsWithBlankLine">
        <p>def <span class="ident">endsWithBlankLine</span>(</p><p>self, block)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns true if block ends with a blank line, descending if needed
into lists and sublists.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.endsWithBlankLine', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.endsWithBlankLine" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">endsWithBlankLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns true if block ends with a blank line, descending if needed</span>
<span class="sd">    into lists and sublists.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.finalize">
        <p>def <span class="ident">finalize</span>(</p><p>self, block, line_number)</p>
      </div>
      

      
  
      <div class="desc"><p>Finalize a block.  Close it and do any necessary postprocessing,
e.g. creating string_content from strings, setting the 'tight'
or 'loose' status of a list, and parsing the beginnings
of paragraphs for reference definitions.  Reset the tip to the
parent of the closed block.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.finalize', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.finalize" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Finalize a block.  Close it and do any necessary postprocessing,</span>
<span class="sd">    e.g. creating string_content from strings, setting the &#39;tight&#39;</span>
<span class="sd">    or &#39;loose&#39; status of a list, and parsing the beginnings</span>
<span class="sd">    of paragraphs for reference definitions.  Reset the tip to the</span>
<span class="sd">    parent of the closed block.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">block</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">line_number</span> <span class="o">&gt;</span> <span class="n">block</span><span class="o">.</span><span class="n">start_line</span><span class="p">):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">block</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">line_number</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;^  *&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span> <span class="ow">and</span> <span class="n">pos</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isBlank</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;ReferenceDef&quot;</span>
                <span class="k">break</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parseReference</span><span class="p">(</span>
                <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="s">r&quot;(\n *)*$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">numitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">numitems</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">last_item</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">numitems</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last_item</span><span class="p">):</span>
                <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
            <span class="n">numsubitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">numsubitems</span><span class="p">):</span>
                <span class="n">subitem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">last_subitem</span> <span class="o">=</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">numsubitems</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endsWithBlankLine</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="ow">not</span> <span class="p">(</span><span class="n">last_item</span> <span class="ow">and</span> <span class="n">last_subitem</span><span class="p">)):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">parent</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.incorporateLine">
        <p>def <span class="ident">incorporateLine</span>(</p><p>self, ln, line_number)</p>
      </div>
      

      
  
      <div class="desc"><p>Analyze a line of text and update the document appropriately.
We parse markdown text by calling this on each line of input,
then finalizing the document.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.incorporateLine', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.incorporateLine" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">incorporateLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Analyze a line of text and update the document appropriately.</span>
<span class="sd">    We parse markdown text by calling this on each line of input,</span>
<span class="sd">    then finalizing the document.&quot;&quot;&quot;</span>
    <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CODE_INDENT</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">blank</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">already_done</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
    <span class="n">oldtip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">detabLine</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">last_child</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">last_child</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">last_child</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">:</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">matched</span>
            <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span>
               <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]):</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
                    <span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
            <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">]:</span>
            <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">offset</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">blank</span><span class="p">:</span>
                <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">all_matched</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_matched</span><span class="p">:</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">break</span>
    <span class="n">last_matched_container</span> <span class="o">=</span> <span class="n">container</span>
    <span class="k">def</span> <span class="nf">closeUnmatchedBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function is used to finalize and close any unmatched</span>
<span class="sd">        blocks.  We aren&#39;t ready to do this now, because we might</span>
<span class="sd">        have a lazy paragraph continuation, in which case we don&#39;t</span>
<span class="sd">        want to close unmatched blocks.  So we store this closure for</span>
<span class="sd">        use later, when we have more information.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">already_done</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">oldtip</span> <span class="o">==</span> <span class="n">last_matched_container</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">oldtip</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
            <span class="n">oldtip</span> <span class="o">=</span> <span class="n">oldtip</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">oldtip</span>
    <span class="k">if</span> <span class="n">blank</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakOutOfLists</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;^[ #`~*+_=&lt;&gt;0-9-]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
            <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ATXmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^#{1,6}(?: +|$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
        <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="s">r&quot;^`{3,}(?!.*`)|^~{3,}(?!.*~)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
        <span class="n">PARmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;^(?:=+|-+) *$&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseListMarker</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;=</span> <span class="n">CODE_INDENT</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">CODE_INDENT</span>
                <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&#39;IndentedCode&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">&quot;BlockQuote&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ATXmatch</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                <span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ATXmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">#&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">container</span><span class="o">.</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(?:(</span><span class="se">\\</span><span class="s">#) *#*| *#+) *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:])]</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">FENmatch</span><span class="p">:</span>
            <span class="n">fence_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                <span class="s">&quot;FencedCode&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span> <span class="o">=</span> <span class="n">fence_length</span>
            <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="o">=</span> <span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">container</span><span class="o">.</span><span class="n">fence_offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">fence_length</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHtmlBlockOpen</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                <span class="s">&#39;HtmlBlock&#39;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">PARmatch</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;SetextHeader&quot;</span>
            <span class="n">container</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">PARmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;=&#39;</span> <span class="k">else</span> <span class="mi">2</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">matchAt</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                <span class="s">&quot;HorizontalRule&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;marker_offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indent</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">listsMatch</span><span class="p">(</span>
               <span class="n">container</span><span class="o">.</span><span class="n">list_data</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;List&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                <span class="s">&quot;ListItem&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">list_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">matchAt</span><span class="p">(</span><span class="s">r&quot;[^ ]&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">first_nonspace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
        <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">first_nonspace</span> <span class="o">=</span> <span class="n">match</span>
        <span class="n">blank</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">first_nonspace</span> <span class="o">-</span> <span class="n">offset</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">==</span> <span class="n">last_matched_container</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blank</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">strings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span> <span class="o">=</span> <span class="n">closeUnmatchedBlocks</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">already_done</span><span class="p">,</span> <span class="n">oldtip</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="n">blank</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">start_line</span> <span class="o">==</span> <span class="n">line_number</span><span class="p">))</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">container</span>
        <span class="k">while</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">last_line_blank</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span> <span class="ow">or</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">first_nonspace</span> <span class="ow">and</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">]</span> <span class="o">==</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_char</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                    <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">match</span>
            <span class="n">FENmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="s">r&quot;^(?:`{3,}|~{3,})(?= *$)&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="p">[</span><span class="n">first_nonspace</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">FENmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">container</span><span class="o">.</span><span class="n">fence_length</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">,</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">]:</span>
            <span class="c"># nothing to do; we already added the contents.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptsLines</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">blank</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">:</span>
                <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
                    <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">first_nonspace</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># print(&quot;Line &quot; + str(line_number) +</span>
                <span class="c">#       &quot; with container type &quot; +</span>
                <span class="c">#       container.t + &quot; did not match any condition.&quot;)</span>
                <span class="k">pass</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.listsMatch">
        <p>def <span class="ident">listsMatch</span>(</p><p>self, list_data, item_data)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns true if the two list items are of the same type,
with the same delimiter and bullet character.  This is used
in agglomerating list items into lists.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.listsMatch', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.listsMatch" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">listsMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_data</span><span class="p">,</span> <span class="n">item_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns true if the two list items are of the same type,</span>
<span class="sd">    with the same delimiter and bullet character.  This is used</span>
<span class="sd">    in agglomerating list items into lists.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;delimiter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bullet_char&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.parse">
        <p>def <span class="ident">parse</span>(</p><p>self, input)</p>
      </div>
      

      
  
      <div class="desc"><p>The main parsing function.  Returns a parsed document AST.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.parse', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.parse" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The main parsing function.  Returns a parsed document AST.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Block</span><span class="o">.</span><span class="n">makeBlock</span><span class="p">(</span><span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;\r\n|\n|\r&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\n$&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incorporateLine</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.parseListMarker">
        <p>def <span class="ident">parseListMarker</span>(</p><p>self, ln, offset)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse a list marker and return data on the marker (type,
start, delimiter, bullet character, padding) or null.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.parseListMarker', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.parseListMarker" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseListMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a list marker and return data on the marker (type,</span>
<span class="sd">    start, delimiter, bullet character, padding) or null.&quot;&quot;&quot;</span>
    <span class="n">rest</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blank_item</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHrule</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^[*+-]( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
    <span class="n">match2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^(\d+)([.)])( +|$)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Bullet&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;bullet_char&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
        <span class="n">spaces_after_marker</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Ordered&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">blank_item</span> <span class="o">=</span> <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">spaces_after_marker</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">spaces_after_marker</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">blank_item</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">spaces_after_marker</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">match2</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match2</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.DocParser.processInlines">
        <p>def <span class="ident">processInlines</span>(</p><p>self, block)</p>
      </div>
      

      
  
      <div class="desc"><p>Walk through a block &amp; children recursively, parsing string content
into inline content where appropriate.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.DocParser.processInlines', this);">Show source.</a></p>
    <div id="source-CommonMark.DocParser.processInlines" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">processInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Walk through a block &amp; children recursively, parsing string content</span>
<span class="sd">    into inline content where appropriate.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;ATXHeader&quot;</span><span class="p">,</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">,</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">]:</span>
        <span class="n">block</span><span class="o">.</span><span class="n">inline_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlineParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">string_content</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processInlines</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>
      
      <div class="item">
        <p id="CommonMark.HTMLRenderer" class="name">class <span class="ident">HTMLRenderer</span></p>
        
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">HTMLRenderer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">blocksep</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">innersep</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">softbreak</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">escape_pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;[&amp;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&quot;[&lt;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&quot;[&gt;]&quot;</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;[&quot;]&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;quot;&#39;</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attribs</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">selfclosing</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Helper function to produce content in a pair of HTML tags.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">tag</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">attrib</span> <span class="o">=</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">contents</span> <span class="o">+</span> <span class="s">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">selfclosing</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s">&quot; /&gt;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">URLescape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Escape href URLs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;mailto|MAILTO&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">preserve_entities</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Escape HTML entities.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">preserve_entities</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span>
                <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">renderInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render an inline element as HTML.&quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Softbreak&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">softbreak</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Hardbreak&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;br&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Emph&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;em&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Strong&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;strong&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Html&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Entity&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;nbsp;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot; &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">URLescape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">)]]</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">,</span> <span class="bp">True</span><span class="p">)],</span> <span class="p">[</span>
                     <span class="s">&#39;alt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))]]</span>
            <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Code&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown inline type &quot;</span> <span class="o">+</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">renderInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a list of inlines.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">renderBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a single block element.&quot;&quot;&quot;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">info_words</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span><span class="p">):</span>
            <span class="n">whole_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">in_tight_list</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">):</span>
            <span class="n">filling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filling</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;blockquote&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="p">[],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span>
                                                 <span class="n">in_tight_list</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Bullet&quot;</span><span class="p">):</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ul&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ol&quot;</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
                <span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[[</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">tight</span><span class="p">)</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ATXHeader&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">)):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;h&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">[],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                                       <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
            <span class="n">info_words</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                <span class="n">info_words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot; +&quot;</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[</span>
                <span class="p">[</span><span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;language-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">info_words</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">True</span><span class="p">)]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                               <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;hr&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown block type&quot;</span> <span class="o">+</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">renderBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render a list of block elements, separated by this.blocksep.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">in_tight_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocksep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass through for renderBlock&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#CommonMark.HTMLRenderer">HTMLRenderer</a></li>
                <li>__builtin__.object</li>
              </ul>
              <h4>Class variables</h4>
                  <div class="item">
                    <p id="CommonMark.HTMLRenderer.blocksep" class="name">var <span class="ident">blocksep</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.HTMLRenderer.escape_pairs" class="name">var <span class="ident">escape_pairs</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.HTMLRenderer.innersep" class="name">var <span class="ident">innersep</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.HTMLRenderer.softbreak" class="name">var <span class="ident">softbreak</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
              <h4>Static methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.inTags">
        <p>def <span class="ident">inTags</span>(</p><p>tag, attribs, contents, selfclosing=None)</p>
      </div>
      

      
  
      <div class="desc"><p>Helper function to produce content in a pair of HTML tags.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.inTags', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.inTags" class="source">
      <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attribs</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">selfclosing</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Helper function to produce content in a pair of HTML tags.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">tag</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">attribs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="n">attribs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="n">attrib</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">contents</span> <span class="o">+</span> <span class="s">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">selfclosing</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="s">&quot; /&gt;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&gt;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>

    </div>
  
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.__init__', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.URLescape">
        <p>def <span class="ident">URLescape</span>(</p><p>self, s)</p>
      </div>
      

      
  
      <div class="desc"><p>Escape href URLs.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.URLescape', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.URLescape" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">URLescape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Escape href URLs.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;mailto|MAILTO&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLquote</span><span class="p">(</span><span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="s">&quot;:/=*%?&amp;)(#&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.escape">
        <p>def <span class="ident">escape</span>(</p><p>self, s, preserve_entities=None)</p>
      </div>
      

      
  
      <div class="desc"><p>Escape HTML entities.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.escape', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.escape" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">preserve_entities</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Escape HTML entities.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">preserve_entities</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="s">&quot;[&amp;](?![#](x[a-f0-9]{1,8}|[0-9]{1,8});|[a-z][a-z0-9]{1,31};)&quot;</span><span class="p">,</span>
            <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="n">HTMLunescape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pairs</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.render">
        <p>def <span class="ident">render</span>(</p><p>self, block, in_tight_list=None)</p>
      </div>
      

      
  
      <div class="desc"><p>Pass through for renderBlock</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.render', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.render" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Pass through for renderBlock&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.renderBlock">
        <p>def <span class="ident">renderBlock</span>(</p><p>self, block, in_tight_list)</p>
      </div>
      

      
  
      <div class="desc"><p>Render a single block element.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.renderBlock', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.renderBlock" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">renderBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">block</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render a single block element.&quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">info_words</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span><span class="p">):</span>
        <span class="n">whole_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">whole_doc</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Paragraph&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_tight_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="p">[],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BlockQuote&quot;</span><span class="p">):</span>
        <span class="n">filling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filling</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;blockquote&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ListItem&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;li&quot;</span><span class="p">,</span> <span class="p">[],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span>
                                             <span class="n">in_tight_list</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;List&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Bullet&quot;</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ul&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;ol&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span>
            <span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[[</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">list_data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])]]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span> <span class="o">+</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">renderBlocks</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">tight</span><span class="p">)</span> <span class="o">+</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">innersep</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ATXHeader&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;SetextHeader&quot;</span><span class="p">)):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;h&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">[],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">inline_content</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IndentedCode&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">HTMLRenderer</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                                   <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FencedCode&quot;</span><span class="p">):</span>
        <span class="n">info_words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
            <span class="n">info_words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot; +&quot;</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[</span>
            <span class="p">[</span><span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;language-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">info_words</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">True</span><span class="p">)]]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span>
                           <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">string_content</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HtmlBlock&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">block</span><span class="o">.</span><span class="n">string_content</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;HorizontalRule&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;hr&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown block type&quot;</span> <span class="o">+</span> <span class="n">block</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.renderBlocks">
        <p>def <span class="ident">renderBlocks</span>(</p><p>self, blocks, in_tight_list=None)</p>
      </div>
      

      
  
      <div class="desc"><p>Render a list of block elements, separated by this.blocksep.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.renderBlocks', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.renderBlocks" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">renderBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">in_tight_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render a list of block elements, separated by this.blocksep.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;ReferenceDef&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderBlock</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">in_tight_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocksep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.renderInline">
        <p>def <span class="ident">renderInline</span>(</p><p>self, inline)</p>
      </div>
      

      
  
      <div class="desc"><p>Render an inline element as HTML.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.renderInline', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.renderInline" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">renderInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inline</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render an inline element as HTML.&quot;&quot;&quot;</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Softbreak&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">softbreak</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Hardbreak&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;br&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Emph&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;em&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Strong&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&quot;strong&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Html&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Entity&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;nbsp;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot; &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">URLescape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">)]]</span>
        <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">destination</span><span class="p">,</span> <span class="bp">True</span><span class="p">)],</span> <span class="p">[</span>
                 <span class="s">&#39;alt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderInlines</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">label</span><span class="p">))]]</span>
        <span class="k">if</span> <span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Code&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inTags</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">inline</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unknown inline type &quot;</span> <span class="o">+</span> <span class="n">inline</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.HTMLRenderer.renderInlines">
        <p>def <span class="ident">renderInlines</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Render a list of inlines.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.HTMLRenderer.renderInlines', this);">Show source.</a></p>
    <div id="source-CommonMark.HTMLRenderer.renderInlines" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">renderInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render a list of inlines.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>
      
      <div class="item">
        <p id="CommonMark.InlineParser" class="name">class <span class="ident">InlineParser</span></p>
        
  
      <div class="desc"><p>INLINE PARSER</p>
<p>These are methods of an InlineParser class, defined below.
An InlineParser keeps track of a subject (a string to be
parsed) and a position in that subject.</p>
<p>If re matches at current position in the subject, advance
position in subject and return the match; otherwise return null.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">InlineParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;  INLINE PARSER</span>

<span class="sd">     These are methods of an InlineParser class, defined below.</span>
<span class="sd">     An InlineParser keeps track of a subject (a string to be</span>
<span class="sd">     parsed) and a position in that subject.</span>

<span class="sd">     If re matches at current position in the subject, advance</span>
<span class="sd">     position in subject and return the match; otherwise return null.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexString</span><span class="p">,</span> <span class="n">reCompileFlags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If re matches at current position in the subject, advance</span>
<span class="sd">        position in subject and return the match; otherwise return null.&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">regexString</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:],</span> <span class="n">flags</span><span class="o">=</span><span class="n">reCompileFlags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the character at the current subject position, or null if</span>
<span class="sd">        there are no more characters.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">spnl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse zero or more space characters, including at most one newline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n *)?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c"># All of the parsers below try to match something at the current position</span>
    <span class="c"># in the subject.  If they succeed in matching anything, they</span>
    <span class="c"># push an inline element onto the &#39;inlines&#39; list.  They return the</span>
    <span class="c"># number of characters parsed (possibly 0).</span>

    <span class="k">def</span> <span class="nf">parseBackticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse backticks, adding either a backtick code span or a</span>
<span class="sd">        literal sequence of backticks to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^`+&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ticks</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">afterOpenTicks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">foundCode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">foundCode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">==</span> <span class="n">ticks</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">afterOpenTicks</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;[ \n]+&quot;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Code&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">))</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ticks</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">afterOpenTicks</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseEscaped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a backslash-escaped special character, adding either the escaped</span>
<span class="sd">        character, a hard line break (if the backslash is followed by a newline),</span>
<span class="sd">        or a literal backslash to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
        <span class="n">subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">reEscapable</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseAutoLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an autolink (URL or email in pointy brackets).&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">&quot;^&lt;([a-zA-Z0-9.!#$%&amp;&#39;*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)&gt;&quot;</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">&quot;^&lt;(?:coap|doi|javascript|aaa|aaas|about|acap|cap|cid|crid|data|dav|dict|dns|file|ftp|geo|go|gopher|h323|http|https|iax|icap|im|imap|info|ipp|iris|iris.beep|iris.xpc|iris.xpcs|iris.lwz|ldap|mailto|mid|msrp|msrps|mtqp|mupdate|news|nfs|ni|nih|nntp|opaquelocktoken|pop|pres|rtsp|service|session|shttp|sieve|sip|sips|sms|snmp|soap.beep|soap.beeps|tag|tel|telnet|tftp|thismessage|tn3270|tip|tv|urn|vemmi|ws|wss|xcon|xcon-userid|xmlrpc.beep|xmlrpc.beeps|xmpp|z39.50r|z39.50s|adiumxtra|afp|afs|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|chrome|chrome-extension|com-eventbrite-attendee|content|cvs|dlna-playsingle|dlna-playcontainer|dtn|dvb|ed2k|facetime|feed|finger|fish|gg|git|gizmoproject|gtalk|hcp|icon|ipn|irc|irc6|ircs|itms|jar|jms|keyparc|lastfm|ldaps|magnet|maps|market|message|mms|ms-help|msnim|mumble|mvn|notes|oid|palm|paparazzi|platform|proxy|psyc|query|res|resource|rmi|rsync|rtmp|secondlife|sftp|sgn|skype|smb|soldat|spotify|ssh|steam|svn|teamspeak|things|udp|unreal|ut2004|ventrilo|view-source|webcal|wtai|wyciwyg|xfire|xri|ymsgr):[^&lt;&gt;</span><span class="se">\x00</span><span class="s">-</span><span class="se">\x20</span><span class="s">]*&gt;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="c"># email</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;mailto:&quot;</span> <span class="o">+</span> <span class="n">dest</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">m2</span><span class="p">:</span>
            <span class="c"># link</span>
            <span class="n">dest2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest2</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest2</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseHtmlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a raw HTML tag.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHtmlTag</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Html&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">scanDelims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan a sequence of characters == c, and return information about</span>
<span class="sd">        the number of delimiters and whether they are positioned such that</span>
<span class="sd">        they can open and/or close emphasis or strong emphasis.  A utility</span>
<span class="sd">        function for strong/emph parsing.&quot;&quot;&quot;</span>
        <span class="n">numdelims</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">char_before</span> <span class="o">=</span> <span class="n">char_after</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>

        <span class="n">char_before</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">numdelims</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="n">char_after</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>

        <span class="n">can_open</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">))</span>
        <span class="n">can_close</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">):</span>
            <span class="n">can_open</span> <span class="o">=</span> <span class="n">can_open</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
            <span class="n">can_close</span> <span class="o">=</span> <span class="n">can_close</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&quot;numdelims&quot;</span><span class="p">:</span> <span class="n">numdelims</span><span class="p">,</span>
            <span class="s">&quot;can_open&quot;</span><span class="p">:</span> <span class="n">can_open</span><span class="p">,</span>
            <span class="s">&quot;can_close&quot;</span><span class="p">:</span> <span class="n">can_close</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">parseEmphasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse emphasis or strong emphasis in an efficient way,</span>
<span class="sd">        with no backtracking.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">first_close</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">nxt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">numdelims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">numdelims</span>
        <span class="k">if</span> <span class="n">startpos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span> <span class="o">+</span> <span class="n">startpos</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span><span class="p">]))</span>
        <span class="n">delimpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_open&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                            <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                            <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">first_close_delims</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">first_close</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">inlines</span><span class="p">[</span>
                            <span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Emph&quot;</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Strong&quot;</span>
                        <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">first_close</span><span class="p">])]</span> <span class="o">+</span> <span class="n">inlines</span><span class="p">[</span>
                            <span class="n">first_close</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c"># error on 362?</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                                <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]))</span>
                        <span class="n">first_close</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">first_close_delims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseLinkTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse link title (sans quotes), returning the string</span>
<span class="sd">        or null if no match.&quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkTitle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">parseLinkDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse link destination, returning the string or</span>
<span class="sd">        null if no match.&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestinationBraces</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestination</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">parseLinkLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link label, returning number of characters parsed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">nest_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">([])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span>
                    <span class="p">[])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
                <span class="n">nest_level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
                <span class="n">nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">([])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="n">nest_level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseRawLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse raw link label, including surrounding [], and return</span>
<span class="sd">        inline contents.  (Note:  this is not a method of InlineParser.)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">InlineParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">parseLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link.  If successful, add the link to</span>
<span class="sd">        inlines.&quot;&quot;&quot;</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">afterlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">startpos</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">startpos</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;(&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\)&quot;</span><span class="p">):</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                        <span class="k">return</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                    <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="n">savepos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
        <span class="n">beforelabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">beforelabel</span><span class="p">:</span><span class="n">beforelabel</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">savepos</span>
            <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
        <span class="k">if</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">[</span><span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;destination&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;destination&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an entity, adding to inlines if successful.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="s">r&quot;^&amp;(?:#x[a-f0-9]{1,8}|#[0-9]{1,8}|[a-z][a-z0-9]{1,31});&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Entity&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a run of ordinary characters, or a single character with</span>
<span class="sd">        a special meaning in markdown, as a plain string, adding to inlines.&quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reMain</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseNewline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse a newline.  If it was preceded by two spaces, return a hard</span>
<span class="sd">        line break; otherwise a soft line break.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;  &quot;</span><span class="p">:</span>
                <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Softbreak&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse an image.  If the opening &#39;!&#39; is not followed</span>
<span class="sd">        by a link, add a literal &#39;!&#39; to inlines.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^!&quot;</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;!&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">)):</span>
                <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Image&quot;</span>
                <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t happen&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">parseReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attempt to parse a link reference, modifying refmap.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>

        <span class="n">matchChars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">matchChars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[:</span><span class="n">matchChars</span><span class="p">]</span>

        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="s">&quot;:&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>

        <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">beforetitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">beforetitle</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n|$)&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">normlabel</span> <span class="o">=</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">refmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normlabel</span><span class="p">,</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="n">refmap</span><span class="p">[</span><span class="n">normlabel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;destination&quot;</span><span class="p">:</span> <span class="n">dest</span><span class="p">,</span>
                <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parse the next inline element in subject, advancing subject position</span>
<span class="sd">        and adding the result to &#39;inlines&#39;.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseNewline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEmphasis</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;!&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseImage</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEntity</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; Parse s as a list of inlines, using refmap to resolve references.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="n">refmap</span>
        <span class="n">inlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">inlines</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; Pass through to parseInlines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInlines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">)</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#CommonMark.InlineParser">InlineParser</a></li>
                <li>__builtin__.object</li>
              </ul>
              <h4>Instance variables</h4>
                  <div class="item">
                    <p id="CommonMark.InlineParser.label_nest_level" class="name">var <span class="ident">label_nest_level</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.InlineParser.pos" class="name">var <span class="ident">pos</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.InlineParser.refmap" class="name">var <span class="ident">refmap</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="CommonMark.InlineParser.subject" class="name">var <span class="ident">subject</span></p>
                    

                    
  
    <div class="source_cont">
</div>

                  </div>
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.__init__', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.match">
        <p>def <span class="ident">match</span>(</p><p>self, regexString, reCompileFlags=0)</p>
      </div>
      

      
  
      <div class="desc"><p>If re matches at current position in the subject, advance
position in subject and return the match; otherwise return null.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.match', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.match" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexString</span><span class="p">,</span> <span class="n">reCompileFlags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; If re matches at current position in the subject, advance</span>
<span class="sd">    position in subject and return the match; otherwise return null.&quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regexString</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:],</span> <span class="n">flags</span><span class="o">=</span><span class="n">reCompileFlags</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parse">
        <p>def <span class="ident">parse</span>(</p><p>self, s, refmap={})</p>
      </div>
      

      
  
      <div class="desc"><p>Pass through to parseInlines.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parse', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parse" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot; Pass through to parseInlines.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInlines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseAutoLink">
        <p>def <span class="ident">parseAutoLink</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse an autolink (URL or email in pointy brackets).</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseAutoLink', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseAutoLink" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseAutoLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse an autolink (URL or email in pointy brackets).&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="s">&quot;^&lt;([a-zA-Z0-9.!#$%&amp;&#39;*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)&gt;&quot;</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="s">&quot;^&lt;(?:coap|doi|javascript|aaa|aaas|about|acap|cap|cid|crid|data|dav|dict|dns|file|ftp|geo|go|gopher|h323|http|https|iax|icap|im|imap|info|ipp|iris|iris.beep|iris.xpc|iris.xpcs|iris.lwz|ldap|mailto|mid|msrp|msrps|mtqp|mupdate|news|nfs|ni|nih|nntp|opaquelocktoken|pop|pres|rtsp|service|session|shttp|sieve|sip|sips|sms|snmp|soap.beep|soap.beeps|tag|tel|telnet|tftp|thismessage|tn3270|tip|tv|urn|vemmi|ws|wss|xcon|xcon-userid|xmlrpc.beep|xmlrpc.beeps|xmpp|z39.50r|z39.50s|adiumxtra|afp|afs|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|chrome|chrome-extension|com-eventbrite-attendee|content|cvs|dlna-playsingle|dlna-playcontainer|dtn|dvb|ed2k|facetime|feed|finger|fish|gg|git|gizmoproject|gtalk|hcp|icon|ipn|irc|irc6|ircs|itms|jar|jms|keyparc|lastfm|ldaps|magnet|maps|market|message|mms|ms-help|msnim|mumble|mvn|notes|oid|palm|paparazzi|platform|proxy|psyc|query|res|resource|rmi|rsync|rtmp|secondlife|sftp|sgn|skype|smb|soldat|spotify|ssh|steam|svn|teamspeak|things|udp|unreal|ut2004|ventrilo|view-source|webcal|wtai|wyciwyg|xfire|xri|ymsgr):[^&lt;&gt;</span><span class="se">\x00</span><span class="s">-</span><span class="se">\x20</span><span class="s">]*&gt;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="c"># email</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="s">&quot;mailto:&quot;</span> <span class="o">+</span> <span class="n">dest</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">m2</span><span class="p">:</span>
        <span class="c"># link</span>
        <span class="n">dest2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dest2</span><span class="p">)],</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest2</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseBackticks">
        <p>def <span class="ident">parseBackticks</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse backticks, adding either a backtick code span or a
literal sequence of backticks to the 'inlines' list.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseBackticks', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseBackticks" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseBackticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse backticks, adding either a backtick code span or a</span>
<span class="sd">    literal sequence of backticks to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^`+&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ticks</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">afterOpenTicks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">foundCode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">foundCode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">==</span> <span class="n">ticks</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">afterOpenTicks</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;[ \n]+&quot;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Code&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;`+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ticks</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">afterOpenTicks</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseEmphasis">
        <p>def <span class="ident">parseEmphasis</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse emphasis or strong emphasis in an efficient way,
with no backtracking.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseEmphasis', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseEmphasis" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseEmphasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse emphasis or strong emphasis in an efficient way,</span>
<span class="sd">    with no backtracking.&quot;&quot;&quot;</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">first_close</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nxt</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">nxt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">numdelims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">numdelims</span>
    <span class="k">if</span> <span class="n">startpos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span> <span class="o">+</span> <span class="n">startpos</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">numdelims</span><span class="p">:</span><span class="n">numdelims</span><span class="p">]))</span>
    <span class="n">delimpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_open&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span>
                <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span>
                <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                        <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanDelims</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;can_close&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">first_close_delims</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;numdelims&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">first_close</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">inlines</span><span class="p">[</span>
                        <span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Strong&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Emph&quot;</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="s">&quot;Emph&quot;</span> <span class="k">if</span> <span class="n">first_close_delims</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;Strong&quot;</span>
                    <span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">inlines</span><span class="p">[</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">first_close</span><span class="p">])]</span> <span class="o">+</span> <span class="n">inlines</span><span class="p">[</span>
                        <span class="n">first_close</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c"># error on 362?</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delimpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
                            <span class="n">inlines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]))</span>
                    <span class="n">first_close</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">first_close_delims</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&quot;numdelims&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseEntity">
        <p>def <span class="ident">parseEntity</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse an entity, adding to inlines if successful.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseEntity', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseEntity" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse an entity, adding to inlines if successful.&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="s">r&quot;^&amp;(?:#x[a-f0-9]{1,8}|#[0-9]{1,8}|[a-z][a-z0-9]{1,31});&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Entity&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseEscaped">
        <p>def <span class="ident">parseEscaped</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse a backslash-escaped special character, adding either the escaped
character, a hard line break (if the backslash is followed by a newline),
or a literal backslash to the 'inlines' list.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseEscaped', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseEscaped" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseEscaped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a backslash-escaped special character, adding either the escaped</span>
<span class="sd">    character, a hard line break (if the backslash is followed by a newline),</span>
<span class="sd">    or a literal backslash to the &#39;inlines&#39; list.&quot;&quot;&quot;</span>
    <span class="n">subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">reEscapable</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])):</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">subj</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseHtmlTag">
        <p>def <span class="ident">parseHtmlTag</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse a raw HTML tag.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseHtmlTag', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseHtmlTag" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseHtmlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse a raw HTML tag.&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reHtmlTag</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Html&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseImage">
        <p>def <span class="ident">parseImage</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse an image.  If the opening '!' is not followed
by a link, add a literal '!' to inlines.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseImage', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseImage" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse an image.  If the opening &#39;!&#39; is not followed</span>
<span class="sd">    by a link, add a literal &#39;!&#39; to inlines.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^!&quot;</span><span class="p">)):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&quot;!&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Link&quot;</span><span class="p">)):</span>
            <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="s">&quot;Image&quot;</span>
            <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t happen&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseInline">
        <p>def <span class="ident">parseInline</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse the next inline element in subject, advancing subject position
and adding the result to 'inlines'.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseInline', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseInline" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseInline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse the next inline element in subject, advancing subject position</span>
<span class="sd">    and adding the result to &#39;inlines&#39;.&quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseNewline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">)):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEmphasis</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;!&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseImage</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&amp;&quot;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseEntity</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseInlines">
        <p>def <span class="ident">parseInlines</span>(</p><p>self, s, refmap={})</p>
      </div>
      

      
  
      <div class="desc"><p>Parse s as a list of inlines, using refmap to resolve references.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseInlines', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseInlines" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseInlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot; Parse s as a list of inlines, using refmap to resolve references.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span> <span class="o">=</span> <span class="n">refmap</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseInline</span><span class="p">(</span><span class="n">inlines</span><span class="p">)):</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">inlines</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseLink">
        <p>def <span class="ident">parseLink</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse a link.  If successful, add the link to
inlines.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseLink', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseLink" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse a link.  If successful, add the link to</span>
<span class="sd">    inlines.&quot;&quot;&quot;</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">afterlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">startpos</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">startpos</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;(&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\)&quot;</span><span class="p">):</span>
                    <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                    <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
            <span class="k">return</span> <span class="mi">0</span>
    <span class="n">savepos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
    <span class="n">beforelabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">reflabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">beforelabel</span><span class="p">:</span><span class="n">beforelabel</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">savepos</span>
        <span class="n">reflabel</span> <span class="o">=</span> <span class="n">rawlabel</span>
    <span class="k">if</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">:</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refmap</span><span class="p">[</span><span class="n">normalizeReference</span><span class="p">(</span><span class="n">reflabel</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;destination&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">&#39;destination&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Link&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parseRawLabel</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseLinkDestination">
        <p>def <span class="ident">parseLinkDestination</span>(</p><p>self)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse link destination, returning the string or
null if no match.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseLinkDestination', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseLinkDestination" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseLinkDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse link destination, returning the string or</span>
<span class="sd">    null if no match.&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestinationBraces</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkDestination</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">res2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseLinkLabel">
        <p>def <span class="ident">parseLinkLabel</span>(</p><p>self)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse a link label, returning number of characters parsed.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseLinkLabel', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseLinkLabel" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseLinkLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse a link label, returning number of characters parsed.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">nest_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nest_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;`&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseBackticks</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseAutoLink</span><span class="p">([])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHtmlTag</span><span class="p">(</span>
                <span class="p">[])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
            <span class="n">nest_level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
            <span class="n">nest_level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseEscaped</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseString</span><span class="p">([])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;]&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_nest_level</span> <span class="o">=</span> <span class="n">nest_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseLinkTitle">
        <p>def <span class="ident">parseLinkTitle</span>(</p><p>self)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse link title (sans quotes), returning the string
or null if no match.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseLinkTitle', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseLinkTitle" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseLinkTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse link title (sans quotes), returning the string</span>
<span class="sd">    or null if no match.&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reLinkTitle</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unescape</span><span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseNewline">
        <p>def <span class="ident">parseNewline</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse a newline.  If it was preceded by two spaces, return a hard
line break; otherwise a soft line break.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseNewline', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseNewline" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseNewline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a newline.  If it was preceded by two spaces, return a hard</span>
<span class="sd">    line break; otherwise a soft line break.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">inlines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">inlines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;  &quot;</span><span class="p">:</span>
            <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Hardbreak&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Str&quot;</span> <span class="ow">and</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                <span class="n">last</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Softbreak&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseRawLabel">
        <p>def <span class="ident">parseRawLabel</span>(</p><p>self, s)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse raw link label, including surrounding [], and return
inline contents.  (Note:  this is not a method of InlineParser.)</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseRawLabel', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseRawLabel" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseRawLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse raw link label, including surrounding [], and return</span>
<span class="sd">    inline contents.  (Note:  this is not a method of InlineParser.)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">InlineParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseReference">
        <p>def <span class="ident">parseReference</span>(</p><p>self, s, refmap)</p>
      </div>
      

      
  
      <div class="desc"><p>Attempt to parse a link reference, modifying refmap.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseReference', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseReference" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">refmap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to parse a link reference, modifying refmap.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">s</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">matchChars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkLabel</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">matchChars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rawlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[:</span><span class="n">matchChars</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="s">&quot;:&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkDestination</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">beforetitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spnl</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseLinkTitle</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">beforetitle</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n|$)&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">normlabel</span> <span class="o">=</span> <span class="n">normalizeReference</span><span class="p">(</span><span class="n">rawlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">refmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normlabel</span><span class="p">,</span> <span class="bp">None</span><span class="p">)):</span>
        <span class="n">refmap</span><span class="p">[</span><span class="n">normlabel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;destination&quot;</span><span class="p">:</span> <span class="n">dest</span><span class="p">,</span>
            <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">startpos</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.parseString">
        <p>def <span class="ident">parseString</span>(</p><p>self, inlines)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse a run of ordinary characters, or a single character with
a special meaning in markdown, as a plain string, adding to inlines.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.parseString', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.parseString" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parseString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a run of ordinary characters, or a single character with</span>
<span class="sd">    a special meaning in markdown, as a plain string, adding to inlines.&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">reMain</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">inlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Block</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="s">&quot;Str&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.peek">
        <p>def <span class="ident">peek</span>(</p><p>self)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns the character at the current subject position, or null if
there are no more characters.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.peek', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.peek" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the character at the current subject position, or null if</span>
<span class="sd">    there are no more characters.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.scanDelims">
        <p>def <span class="ident">scanDelims</span>(</p><p>self, c)</p>
      </div>
      

      
  
      <div class="desc"><p>Scan a sequence of characters == c, and return information about
the number of delimiters and whether they are positioned such that
they can open and/or close emphasis or strong emphasis.  A utility
function for strong/emph parsing.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.scanDelims', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.scanDelims" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">scanDelims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Scan a sequence of characters == c, and return information about</span>
<span class="sd">    the number of delimiters and whether they are positioned such that</span>
<span class="sd">    they can open and/or close emphasis or strong emphasis.  A utility</span>
<span class="sd">    function for strong/emph parsing.&quot;&quot;&quot;</span>
    <span class="n">numdelims</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">first_close_delims</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">char_before</span> <span class="o">=</span> <span class="n">char_after</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
    <span class="n">char_before</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="o">==</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">numdelims</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
    <span class="n">char_after</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>
    <span class="n">can_open</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">))</span>
    <span class="n">can_close</span> <span class="o">=</span> <span class="p">(</span><span class="n">numdelims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">numdelims</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s">&quot;_&quot;</span><span class="p">):</span>
        <span class="n">can_open</span> <span class="o">=</span> <span class="n">can_open</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_before</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
        <span class="n">can_close</span> <span class="o">=</span> <span class="n">can_close</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[a-z0-9]&quot;</span><span class="p">,</span> <span class="n">char_after</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&quot;numdelims&quot;</span><span class="p">:</span> <span class="n">numdelims</span><span class="p">,</span>
        <span class="s">&quot;can_open&quot;</span><span class="p">:</span> <span class="n">can_open</span><span class="p">,</span>
        <span class="s">&quot;can_close&quot;</span><span class="p">:</span> <span class="n">can_close</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="CommonMark.InlineParser.spnl">
        <p>def <span class="ident">spnl</span>(</p><p>self)</p>
      </div>
      

      
  
      <div class="desc"><p>Parse zero or more space characters, including at most one newline.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-CommonMark.InlineParser.spnl', this);">Show source.</a></p>
    <div id="source-CommonMark.InlineParser.spnl" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">spnl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse zero or more space characters, including at most one newline.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^ *(?:\n *)?&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>



<hr>
<p style="text-align: right;">
  Documentation generated by
  <code><a href="https://github.com/BurntSushi/pdoc">pdoc</a></code>
  0.2.4.

  pdoc is in the public domain with the
  <a href="http://unlicense.org">UNLICENSE</a>.
</p>
</div>
</body>
</html>
